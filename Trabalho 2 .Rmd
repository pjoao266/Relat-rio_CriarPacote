---
title: "Como fazer um pacote no R"
author: "André, Jéferson, João Pedro e Maísa"
date: "13/10/2020"
output:
  html_document:
    toc: true
    toc_float:
      collapsed: true
      smooth_scroll: true
    theme: yeti
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r}
htmltools::img(src = knitr::image_uri("UFMG-logo.png"), 
               alt = 'logo', 
               style = 'position:absolute; top:0; right:0;  padding:10px; width: 150px'
               )
```
```{r, message=FALSE, warning=FALSE}
if (!require("DT")){ install.packages('DT');require("DT")}
if (!require("knitr")){ install.packages('knitr');require("knitr")}
if (!require("tidyverse")){install.packages('tidyverse');require("tidyverse")}
if (!require("devtools")){install.packages('devtools');require("devtools")}
```
<div style="text-align:justify;">

## Introdução

### A escolha do tema

O grupo escolheu o tema *'Como fazer um pacote no R'* por acha-lo um tema relevante para o conteúdo da disciplina, onde pode-se aplicar os vários conhecimentos adquiridos até aqui, como por exemplo o uso frequente de funções criadas. Quando se realiza um mesmo processo varias vezes, criar uma função que ajude nessa tarefa é muito útil. E para que fique mais simples acessar essa função, pode-se criar um pacote para guarda-lá. Além disso, esse pacote pode ser publicado para que as suas funções possam ser usadas e aprimoradas por outros usuários.

Neste trabalho vamos mostrar como transformar suas funções em um pacote e publicá-lo.

### O Pacote qqr

Como exemplo de como criar um pacote, vamos apresentar todo o passo a passo de criação do pacote qqr. Este pacote tem como funcionalidade a leitura da tabela oficial do Brasileirão 2020 atualizada além de ter disponível a tabela do campeonato referente a 2014.

Destaca-se que existem várias formas de criar um pacote. Iremos criar usando o pacote *devtools*, que é uma maneira mais simples e que possui funções para criar, conferir o pacote, testar e documentar as funções, tudo dentro de uma sessão do R.

## Passo a passo da criação de um pacote

### Criando o ambiente do pacote

O primeiro passa na criação de um pacote é criar um ambiente. Isso pode ser feito da seguinte forma:

  1. Primeiro clique em R Project > New Project.  

<div align="center">
```{r}
htmltools::img(src = knitr::image_uri("imagem1.png"),
               alt = 'New Project')
```
</div>    
<br>  

  2. Então selecione a opção New Directory > R Package.
  
<div align="center">
```{r}
htmltools::img(src = knitr::image_uri("imagem2.png"),
               alt = 'R Package')
```
</div>
<br>  
  
  3. Por fim, preencha o nome que você quer dar para o seu pacote e selecione o diretório onde ficará todos os arquivos.

<div align="center">
```{r}
htmltools::img(src = knitr::image_uri("imagem3.png"),
               alt = 'New Project')
```
</div>
<br> 

Outra maneira de criar o ambiente é pelo devtools, da seguinte forma:  
   
```{r, eval=FALSE, echo=TRUE}
 create('qqr')
```
   
 
Após a criação do ambiente, o R criará automaticamente os arquivos da imagem a seguir, além de um script com um exemplo de uma função 'hello word'.

<div align="center">
```{r}
htmltools::img(src = knitr::image_uri("imagem4.png"),
               alt = 'Arquivos')
```
</div>
<br> 

### Estrutura de um pacote

Depois de seguir todos os passos anteriores, finalmente temos a estrutura do nosso pacote, que funciona assim:

- Temos uma pasta R (diretório 'R/). Nela ficarão armazenadas todas as funções do pacote, inclusive a 'hello word' que foi criada automaticamente. Também é armazenado as documentações dos scripts e dos banco de dados, caso o pacote possua. Os arquivos nesta pasta tem a extensão .R (ex: hello.R).

- Uma pasta (diretório 'man/') chamada man onde ficará todos os arquivos de documentação do das funções que estão no diretório acima. Os arquivos nesta pasta têm a extensão .Rd (ex: hello.Rd) e são gerados automaticamentes, portanto não devem ser editados.

- Um arquivo de texto chamado DESCRIPTION com as informações sobre o pacote, como autor, pacotes que são necessários para o funcionamento do seu pacote, versão do R mínima, entre outros.

- Um arquivo de texto chamado NAMESPACE que informa quais funções do pacote serão exportadas (disponíveis para o usuário) e quais serão importadas de outros pacotes dos quais o seu depende.


Existem também outros arquivos que não são criados automáticamente e nem obrigatórios para o pacote, mas podem estar presentes. São eles:

- Uma pasta chamada tests (diretório 'tests/') contendo scripts com testes, rodados durante a criação do pacote para encontrar algum resultado não esperado. 

- Uma pasta chamada vignettes (diretório 'vignettes/') contendo uma ou mais vignettes que são um pequeno tutorial das funções do pacote.

- Uma pasta chamada data (diretório '/data') contendo arquivos de dados que podem ser usados como exemplos na utilização das funções do pacote. É preferivel que estes arquivos estejam em formato binario e comprimido (ex: .rda).


### Criando as funções


### Adicionando uma base de dados no pacote

Adicionar bases de dados ao pacote, seja para usar como exemplo ou para disponibiliza-lás para os usuários (como no caso deste pacote), é bem simples e pode ser feito utilizando o devtools.
Primeiro você deve ter sua base no r, salvo em um objeto e então salva-la como .rda, que pode ser feito da sequinte forma:

```{r}
dados = data.frame(a= c(1,2),
                   b= c(3, 4))
```


```{r, eval=FALSE, echo=TRUE}
saveRDS(object = dados, file = 'qqr/data/dados.rda')
```

É importante ressaltar que o nome do arquivo precisa ser o igual ao nome objeto.

Depois de salvo, você deve armazenar essa base na pasta data e caso ela não exista você deve cria-lá.



### Documentando as funções e as bases de dados

### Document


### Vignettes


### Criando o help do pacote


### Preparando o pacote para instalação


### NameSpace


### Instalando o pacote localmente

### Publicando o pacote

Finalizado o pacote você pode publicá-lo para que outras pessoas tenham acesso. Existem duas maneiras mais usuais, que é colocando-o em um repositório (GitHub, GitLab, entre outros) ou subindo para o CRAN. 
Colocando em um repositório as pessoas acessam o pacote tanto pela web quanto pelo R atraves algumas funções especificas. Já no CRAN, seu pacote está na plataforma oficial e portanto pode ser usado com a função *'install.packages()'*.

Será apresentado as duas maneiras de publicar o pacote, sendo que para repositório será usado o GitHub.

#### No GitHub:

Antes de tudo, é necessário que você tenha o Git instalado. Você pode baixar através do link: https://git-scm.com/downloads.

É preciso também ter uma conta no GitHub. Caso não tenha, você pode criar através do link: https://github.com/join.

Com a conta feita, você cria um  novo repositório, escolhe suas preferências de nome, privacidade, colaboradores... Então voce abre a pasta do seu pacote e clica com o botão direito e seleciona 'Git Bash Here'.

<div align="center">
```{r}
htmltools::img(src = knitr::image_uri("imagem5.png"),
               alt = 'Git BAsh')
```
</div>
<br> 

Então irá abrir uma guia do Git, onde você deve colocar seu email e username do GitHub/GitLab da seguinte maneira (com suas credenciais, é claro):

<div align="center">
```{r}
htmltools::img(src = knitr::image_uri("imagem6.png"),
               alt = 'Git config')
```
</div>
<br> 

Esse passo anterior também pode ser feito no terminal do R, ou até mesmo com a seguinte linha de comando:

```{r, eval=FALSE, echo=TRUE}
usethis::use_git_config(user.name = "maisaand", # Seu nome
                        user.email = "maisaandrade097@gmail.com") # Seu email
```

Depois de configurado seus dados, voce digita o comando *git init* no terminal do R ou na guia do Git (os dois processos são iguais, escolha o que preferir) para iniciar o processo. 

Depois, você precisa conectar a sua pasta local com o servidor, que (quando sua pasta local já existe) é feita da seguinte forma:

<div align="center">
```{r}
htmltools::img(src = knitr::image_uri("imagem7.png"),
               alt = 'Git remote')
```
</div>
<br> 

Obs.: Caso queira baixar uma pasta existente no GitHub para o seu computador, digite o comando:

```{r, echo=TRUE, eval=FALSE}
git clone https://github.com/username/repositorio.git
```

Depois de conectar sua pasta ao GitHub, o proximo passo é adicionar os arquivos. O comando para isso é:

```{r, echo=TRUE, eval=FALSE}
git add .
```

Vale ressaltar que no Git cada espaço importa, então tente prestar muita atenção no código.

Para salvar os arquivos no repositório, o chamado 'commit' use o comando:

```{r, echo=TRUE, eval=FALSE}
git commit -m"comentário qualquer"
```


E então, finalmente, use:

```{r, echo=TRUE, eval=FALSE}
git push -u origin master
```

Esse último comando serve para subir os arquivos para o repositório pela primeira vez. Nas vezes seguintes pode ser utilizado apenas *git push*.
Assim, se a seguinte mensagem aparecer, pronto! Deu tudo certo e seu pacote já está disponível no Github.

<div align="center">
```{r}
htmltools::img(src = knitr::image_uri("imagem8.png"),
               alt = 'Git push')
```
</div>
<br> 

Agora, para baixar o pacote no R, basta fazer:

```{r, echo=TRUE, eval=FALSE}
devtools::install_github("https://github.com/jeff25601/qqr", build_vignettes =TRUE)
```

Um comando que é bastante útil e pode ser usado em qualquer parte do processo é 'git status'. Ele mostra se algum item ainda não foi adicionado, se é preciso 'comitar' os arquivos, e outras informações.

O Git é uma ferramenta com muitos recursos e o que foi mostrado é apenas uma parte superficial. O google pode ser utilizado para encontrar muitas informações e resolver problemas.

#### No CRAN:


## Conclusão

Depois de realizar todas as etapas da criação do pacote, pode-se observar na imagem abaixo o repositório oficial do pacote qqr no Github:

<div align="center">
```{r}
htmltools::img(src = knitr::image_uri("imagem9.png"),
               alt = 'GitHub')
```
</div>
<br> 


## Referências

1. http://cursos.leg.ufpr.br/prr/capPacR.html#
2. https://cran.r-project.org/web/packages/devtools/index.html
3. https://cran.r-project.org/doc/contrib/Leisch-CreatingPackages.pdf
4. https://developer.r-project.org/Rds.html
5. https://cran.r-project.org/doc/manuals/r-release/R-exts.html#Package-Dependencies
 
</div> 

<div class="tocify-extend-page" data-unique="tocify-extend-page" style="height: 0;"></div>
